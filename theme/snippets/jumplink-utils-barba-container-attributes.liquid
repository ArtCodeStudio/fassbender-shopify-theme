{% if template == blank %}
  {% assign template = 'no-barba' %}
{% endif %}

{% assign namespace = template | replace: '.', ' ' | truncatewords: 1, '' | handleize %}
data-title="{% include 'jumplink-utils-get-title' %}"
data-namespace="{{ namespace }}"
data-template='{% include 'jumplink-utils-json-template' %}'

data-seo-page-title={{ page_title | json }}
data-seo-page_description={{ page_description | json }}

{% if page %}
  data-handle={{ page.handle | json }}
  data-page='{% include 'jumplink-utils-json-page' %}'
{% endif %}

{% if product %}
  data-handle={{ product.handle | json }}
  data-product-url="{{collection.url}}{{product.url}}"
  data-product-title='{{product.title | replace: "'", "&#39;"}}'
  data-product='{{product | json | replace: "'", "&#39;"}}'

  {% for variant in product.variants %}
    data-product-variant{{variant.id}}-incoming='{{variant.incoming | json}}'
    data-product-variant{{variant.id}}-next-incoming-date='{{variant.next_incoming_date}}'
  {% endfor %}

  data-product-metafields-global='{{product.metafields.global | json | replace: "'", "&#39;"}}'

  data-product-metafields-cf='{{product.metafields.c_f | json | replace: "'", "&#39;"}}'

  {% if collection.previous_product %}
    data-product-prev-url="{{collection.previous_product}}"
  {% endif %}

  {% if collection.next_product %}
    data-product-next-url="{{collection.next_product}}"
  {% endif %}
{% endif %}

{% if collection %}
  data-handle={{ collection.handle | json }}
  data-collection-handle={{collection.handle | json }}
  data-collection-title={{collection.title | json }}

  {% comment %}
    Paginate informations needed for the show all products function
  {% endcomment %}
  data-paginate-pages-current-index="{{ current_page }}"

  {% paginate collection.products by settings.products_per_page %}

    data-collection-products-count={{collection.products | size | json }}

    {% if paginate.previous.is_link %}
      data-paginate-previous-url="{{ paginate.previous.url }}"
    {% endif %}

    {% if paginate.next.is_link %}
      data-paginate-next-url="{{ paginate.next.url }}"
    {% endif %}

    {% for part in paginate.parts %}

      {% comment %}
        The count of pagination pages is in the url of the last part.url
        e.g if the url is "/collections/all?page=11" the length of pages is 11
        part.url is unset if this is the current page
        {% endcomment %}
      {% if forloop.last %}
        {% assign string_to_remove = '/collections/' | append: collection.handle | append: '?page=' %}
        {% assign calced_current_page = part.url | remove: string_to_remove %}
        {% if calced_current_page == blank %}
          {% assign calced_current_page = current_page %}
        {% endif %}
        data-paginate-pages-length="{{ calced_current_page }}"
      {% endif %}

      
    {% endfor %}

  {% endpaginate %}

{% endif %}

{% if paginate_hash %}
  data-paginate-hash="{{paginate_hash}}"
{% endif %}

{% if search %}
  data-search-results-count="{{search.results_count}}"
  {% if search.results_count == 1 %}
    data-search-result-url={{search.results[0].url}}
  {% endif %}
{% endif %}

{% if cart %}
  data-cart={{cart | json}}
{% endif %}

{% if blog %}
  data-handle={{ blog.handle | json }}
  data-blog='{% include 'jumplink-utils-json-blog' %}'
{% endif %}

{% if article %}
  data-handle={{article.handle | json}}
  data-article='{% include 'jumplink-utils-json-article' %}'
{% endif %}